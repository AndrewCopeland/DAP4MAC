---
- name: Check if Jenkins is already running
  uri:
    url: "https://{{jenkinsIngressRoute}}"
    return_content: yes
    body_format: json
    validate_certs: no
    method: GET
    status_code: 200, 404
  register: jenkinsWeb

- name: Set jenkins status
  set_fact:
    jenkinsStatus: "configured"
  when: jenkinsWeb.status == 200

- name: Set jenkins status
  set_fact:
    jenkinsStatus: "unconfigured"
  when: jenkinsWeb.status == 404

- name: Set up jenkins
  block:
    - name: Load Jenkins manifest
      k8s:
        state: present
        src: "{{ playbook_dir }}/files/manifests/{{ item }}.yml"
        wait: yes
        wait_condition:
          reason: completed
          status: "True"
      with_items:
        - jenkinsManifest

    - name: Set jenkins status
      set_fact:
        jenkinsStatus: "initialConfigured"
  when: jenkinsStatus == "unconfigured" and sslConfigMap == "configured"
